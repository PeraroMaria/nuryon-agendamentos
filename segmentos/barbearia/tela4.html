<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Escolha seu Horário</title>
  <link rel="stylesheet" href="../css/estilo.css" />
<script>
  const empresa = JSON.parse(localStorage.getItem("empresa")) || {};
  const tema = empresa.tema || "#85d1c1";
  const estilo = document.createElement("style");
  estilo.innerHTML = `:root { --cor-tema: ${tema}; }`;
  document.head.appendChild(estilo);
</script>


  <style>

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(to bottom, #101010, #1a1a1a);
      color: #fff;
      margin: 0;
      padding: 1rem;
    }

    h1 {
      text-align: center;
      color: var(--cor-tema);
    }

    .subtitulo {
      text-align: center;
      margin-bottom: 2rem;
    }

    .datas-container {
      display: flex;
      overflow-x: auto;
      margin-bottom: 2rem;
      padding: 1rem;
      gap: 10px;
    }

    .dia {
      min-width: 80px;
      padding: 10px;
      background-color: #1f1f1f;
      border: 2px solid var(--cor-tema);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      flex-shrink: 0;
    }

    .dia.selecionado {
      background-color: var(--cor-tema);
      color: #000;
    }

    .turno {
      margin-top: 1rem;
    }

    .turno h2 {
      color: var(--cor-tema);
      margin-bottom: 0.5rem;
    }

    .horarios {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .hora {
      padding: 10px 15px;
      border: 2px solid var(--cor-tema);
      border-radius: 5px;
      cursor: pointer;
      color: var(--cor-tema);
      background-color: transparent;
    }

    .hora.indisponivel {
      border-color: #666;
      color: #666;
      cursor: not-allowed;
    }

    .hora.selecionado {
      background-color: var(--cor-tema);
      color: #000;
    }

    .botao-confirmar {
      display: block;
      margin: 2rem auto 0;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      background-color: transparent;
      border: 2px solid var(--cor-tema);
      color: var(--cor-tema);
      border-radius: 30px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Escolha o seu horário</h1>
  <p class="subtitulo">Selecione a data e o horário desejado para o atendimento</p>

  <div class="datas-container" id="datas"></div>

  <div class="turno" id="manha">
    <h2>Manhã</h2>
    <div class="horarios" id="horarios-manha"></div>
  </div>
  <div class="turno" id="tarde">
    <h2>Tarde</h2>
    <div class="horarios" id="horarios-tarde"></div>
  </div>
  <div class="turno" id="noite">
    <h2>Noite</h2>
    <div class="horarios" id="horarios-noite"></div>
  </div>

  <button class="botao-confirmar">Confirmar Agendamento</button>

  <script>
    const datasContainer = document.getElementById("datas");
    const horariosManha = document.getElementById("horarios-manha");
    const horariosTarde = document.getElementById("horarios-tarde");
    const horariosNoite = document.getElementById("horarios-noite");
    let dataSelecionada = null;

    function gerarDatasProximosDias() {
      const hoje = new Date();
      for (let i = 0; i < 14; i++) {
        const data = new Date();
        data.setDate(hoje.getDate() + i);

        const dia = document.createElement("div");
        dia.classList.add("dia");
        dia.innerHTML = `
          <div>${data.toLocaleDateString('pt-BR', { weekday: 'short' }).toUpperCase()}</div>
          <div>${String(data.getDate()).padStart(2, '0')}/${String(data.getMonth()+1).padStart(2, '0')}</div>
        `;
        dia.addEventListener("click", () => {
          document.querySelectorAll(".dia").forEach(d => d.classList.remove("selecionado"));
          dia.classList.add("selecionado");
          dataSelecionada = new Date(data);
          renderizarHorarios(dataSelecionada);
        });

        if (i === 0) {
          dia.classList.add("selecionado");
          dataSelecionada = new Date(data);
        }

        datasContainer.appendChild(dia);
      }
    }

    function renderizarHorarios(data) {
      const horarios = {
        manha: ["09:00", "09:15", "09:30", "09:45", "10:00", "10:15", "10:30", "10:45", "11:00", "11:15", "11:30", "11:45"],
        tarde: ["12:00", "12:15", "12:30", "12:45", "13:00", "13:15", "13:30", "13:45", "14:00", "14:15", "14:30", "14:45", "15:00", "15:15", "15:30", "15:45", "16:00", "16:15", "16:30", "16:45", "17:00", "17:15", "17:30", "17:45"],
        noite: ["18:00", "18:15", "18:30", "18:45", "19:00", "19:15", "19:30", "19:45"]
      };

      [horariosManha, horariosTarde, horariosNoite].forEach(div => div.innerHTML = "");

      const agora = new Date();

      for (const [turno, lista] of Object.entries(horarios)) {
        const container = document.getElementById(`horarios-${turno}`);
        lista.forEach(hora => {
          const [h, m] = hora.split(":").map(Number);
          const dataHora = new Date(data.getFullYear(), data.getMonth(), data.getDate(), h, m);
          const btn = document.createElement("div");
          btn.classList.add("hora");
          btn.textContent = hora;

          if (dataHora < agora) {
            btn.classList.add("indisponivel");
          } else {
            btn.addEventListener("click", () => {
              document.querySelectorAll(".hora").forEach(b => b.classList.remove("selecionado"));
              btn.classList.add("selecionado");
            });
          }

          container.appendChild(btn);
        });
      }
    }

    gerarDatasProximosDias();
    renderizarHorarios(new Date());
    document.querySelector('.botao-confirmar').addEventListener('click', () => {
  
const nome = localStorage.getItem("clienteNome");
const email = localStorage.getItem("clienteEmail");
const telefone = localStorage.getItem("clienteTelefone");

let servico, profissional;

try {
  servico = JSON.parse(localStorage.getItem("servicoSelecionado"));
} catch (e) {
  console.error("Erro ao ler servicoSelecionado:", e);
}

profissional = localStorage.getItem("profissionalSelecionado");


  const horarioSelecionado = document.querySelector(".hora.selecionado");
  const diaSelecionado = document.querySelector(".dia.selecionado");

  if (!nome || !email || !telefone || !servico || !profissional || !horarioSelecionado || !diaSelecionado) {
    alert("Por favor, preencha todas as etapas do agendamento.");
    return;
  }

  const dataTexto = diaSelecionado.innerText.split('\n')[1]; // formato: 22/07
  const resumo = {
    nome,
    email,
    telefone,
    servico: servico.nome,
    profissional: profissional,

    data: dataTexto,
    hora: horarioSelecionado.textContent
  };

  localStorage.setItem("resumoAgendamento", JSON.stringify(resumo));
  console.log("Redirecionando para tela5.html");
  const empresaSlug = new URLSearchParams(window.location.search).get("empresa");
  window.location.href = `tela5.html?empresa=${empresaSlug}`;

});

  </script>
</body>
</html>
